<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Or√ßamento | Pena Planejados</title>

<!-- FAVICON -->
<link rel="icon" type="image/png" href="favicon.png">

<!-- PWA -->
<link rel="manifest" href="manifest.json">

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        vinho: '#7a0f2b',
        cinza: '#e5e5e5'
      }
    }
  }
}
</script>

<style>
@media print {
  body { background: white; }
}
input:disabled, textarea:disabled {
  background-color: #f3f4f6;
}
</style>
</head>

<body class="bg-gray-200 p-4 flex justify-center">

<!-- CONTAINER A4 -->
<div id="orcamento" class="bg-white w-[210mm] min-h-[297mm] shadow-xl">

<!-- CABE√áALHO -->
<header class="flex justify-between items-center p-6 border-b-4 border-vinho">
  <img src="logo.png" class="w-56 object-contain" alt="Pena Planejados">

  <div class="text-right text-sm">
    <p>Rua do Hospital s/n Santa Am√©lia ‚Äì Posto da Mata ‚Äì BA</p>
    <p><strong>Respons√°veis:</strong> Fl√°vio Pena e Gilm√°ria Pena</p>
    <p><strong>Contato:</strong> (73) 99959-4928 / (73) 99999-2026</p>
    <p id="dataAtual" class="text-vinho font-bold"></p>
  </div>
</header>

<!-- DADOS PESSOAIS -->
<section class="p-6">
  <h2 class="bg-cinza text-vinho font-bold px-4 py-2">DADOS PESSOAIS</h2>

  <div class="grid grid-cols-3 gap-4 mt-4">
    <input class="campo border p-2" placeholder="Cliente">
    <input class="campo border p-2" placeholder="Telefone">
    <input class="campo border p-2" placeholder="Endere√ßo">
  </div>
</section>

<!-- OR√áAMENTO -->
<section class="p-6">
  <h2 class="bg-cinza text-vinho font-bold px-4 py-2">OR√áAMENTO</h2>

  <table class="w-full border mt-4 text-sm">
    <thead class="bg-cinza text-vinho">
      <tr>
        <th class="border p-2">Descri√ß√£o</th>
        <th class="border p-2 w-20">Qtd</th>
        <th class="border p-2 w-32">√Ä Vista</th>
        <th class="border p-2 w-32">√Ä Prazo</th>
        <th class="border p-2 w-14">üóë</th>
      </tr>
    </thead>

    <tbody id="itens"></tbody>

    <tfoot>
      <tr>
        <td colspan="2" class="border p-2 text-right font-bold bg-cinza">VALOR TOTAL</td>
        <td id="totalVista" class="border p-2 font-bold">R$ 0,00</td>
        <td id="totalPrazo" class="border p-2 font-bold">R$ 0,00</td>
        <td class="border"></td>
      </tr>
    </tfoot>
  </table>

  <button onclick="adicionarLinha()" class="mt-4 bg-vinho text-white px-4 py-2 rounded">
    Adicionar Item
  </button>
</section>

<!-- OBSERVA√á√ïES -->
<section class="p-6 text-sm">
  <h2 class="bg-cinza text-vinho font-bold px-4 py-2">OBSERVA√á√ïES</h2>
  <p class="mt-2">‚Ä¢ Validade do or√ßamento: 15 dias ap√≥s o envio.</p>
  <p>‚Ä¢ Prazo de entrega: A combinar.</p>
  <p>‚Ä¢ Forma de pagamento: 50% na assinatura do contrato e 50% na entrega.</p>
</section>

<!-- CONSIDERA√á√ïES FINAIS (COMPLETAS) -->
<section class="p-6 text-sm">
  <h2 class="bg-cinza text-vinho font-bold px-4 py-2">CONSIDERA√á√ïES FINAIS</h2>

  <p class="mt-4">
    Prezado(a) Sr.(a),
  </p>

  <p class="mt-2">
    A Pena Planejados agradece a oportunidade de apresentar este or√ßamento.
    Nosso compromisso √© oferecer produtos de qualidade, aliados a um atendimento
    respons√°vel e transparente, buscando sempre a satisfa√ß√£o total de nossos clientes.
  </p>

  <p class="mt-2">
    Permanecemos √† disposi√ß√£o para quaisquer esclarecimentos, ajustes ou informa√ß√µes
    adicionais que se fa√ßam necess√°rias.
  </p>

  <p class="mt-6 text-center font-bold text-vinho">
    Eben√©zer at√© aqui nos ajudou o Senhor (1 Sm 7:12)
  </p>
</section>

<!-- BOT√ïES -->
<div class="flex justify-center gap-4 p-6">
  <button onclick="gerarPDF()" class="bg-green-600 text-white px-4 py-2 rounded">
    Gerar PDF
  </button>

  <button onclick="window.print()" class="bg-blue-600 text-white px-4 py-2 rounded">
    Imprimir / WhatsApp
  </button>
</div>

</div>

<!-- SCRIPT -->
<script>
// Data
document.getElementById('dataAtual').innerText =
  new Date().toLocaleDateString('pt-BR')

// Adicionar linha
function adicionarLinha(){
  const tr = document.createElement('tr')
  tr.innerHTML = `
    <td class="border p-2"><input class="campo w-full border p-1"></td>
    <td class="border p-2"><input type="number" value="1" min="1" class="campo w-full border p-1 qtd"></td>
    <td class="border p-2"><input type="number" step="0.01" class="campo w-full border p-1 vista"></td>
    <td class="border p-2"><input type="number" step="0.01" class="campo w-full border p-1 prazo"></td>
    <td class="border p-2 text-center">
      <button onclick="removerLinha(this)" class="text-red-600 font-bold">‚úñ</button>
    </td>
  `
  itens.appendChild(tr)
  tr.querySelectorAll('input').forEach(i => i.addEventListener('input', calcularTotais))
}

// Remover linha
function removerLinha(btn){
  btn.closest('tr').remove()
  calcularTotais()
}

// Totais
function calcularTotais(){
  let v = 0, p = 0
  document.querySelectorAll('#itens tr').forEach(tr => {
    const qtd = +tr.querySelector('.qtd').value || 0
    v += qtd * (+tr.querySelector('.vista').value || 0)
    p += qtd * (+tr.querySelector('.prazo').value || 0)
  })
  totalVista.innerText = v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})
  totalPrazo.innerText = p.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})
}

// PDF AJUST√ÅVEL + BLOQUEIO
function gerarPDF(){
  document.querySelectorAll('.campo').forEach(c => c.disabled = true)

  html2pdf().set({
    filename: 'orcamento-pena-planejados.pdf',
    margin: 8,
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2, useCORS: true },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
  }).from(document.getElementById('orcamento')).save()
}

// Linha inicial
adicionarLinha()

// Service Worker
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js')
}
</script>

</body>
</html>
